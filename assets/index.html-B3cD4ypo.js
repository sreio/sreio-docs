import{_ as s,c as a,e,o as t}from"./app-DWByWgeb.js";const n={};function l(h,i){return t(),a("div",null,i[0]||(i[0]=[e(`<p>本章节介绍MongoDB Aggregation Pipeline (聚合管道)，主要用于统计分析，类似SQL的group by语句，Mongo shell通过db.collection.aggregate()函数实现统计分析。</p><h2 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h2><p>聚合管道（Aggregation Pipeline）是一个抽象的概念，把数据比作管道中的水，水在管道中流动，然后我们就可以对管道中的数据进行多个阶段（stage）处理，一个阶段处理完数据，再把处理的结果传给下一个阶段进行处理。</p><ul><li><p>聚合管道在统计分析中应用例子：</p><ul><li>第一阶段，从集合中根据条件查找出一批文档数据</li><li>第二阶段，对第一阶段搜出来的文档数据进行分组统计</li><li>第三阶段，对二阶段统计数据进行排序</li></ul></li></ul><p>整个过程就是一个流水线式的操作，数据从管道的一头流进去，经过几个阶段处理后，输出一个最终的结果。</p><h2 id="mongodb管道支持的操作符" tabindex="-1"><a class="header-anchor" href="#mongodb管道支持的操作符"><span>MongoDB管道支持的操作符</span></a></h2><p>下面是MongoDB常用的管道操作符</p><table><thead><tr><th style="text-align:center;">操作符</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:center;">$match</td><td style="text-align:center;">$match阶段，用于根据条件筛选文档数据，跟SQL的where条件类似</td></tr><tr><td style="text-align:center;">$group</td><td style="text-align:center;">$group阶段，用于对文档数据进行分组统计，这里跟SQL的group by类似</td></tr><tr><td style="text-align:center;">$sort</td><td style="text-align:center;">用于对数据进行排序</td></tr></tbody></table><h2 id="聚合管道使用步骤" tabindex="-1"><a class="header-anchor" href="#聚合管道使用步骤"><span>聚合管道使用步骤</span></a></h2><ul><li><p>通常就是三个步骤：</p><ul><li>通过$match筛选目标数据</li><li>通过$group对数据进行分组统计</li><li>通过$sort对结果进行排序（可选）</li></ul></li></ul><p>例子:</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">db.orders.aggregate([</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                     {</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $match</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">A</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> }</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> },</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                     {</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $group</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> _id:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$cust_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> total:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $sum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$amount</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> }</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> }</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> },</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                     {</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $sort</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> total:</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> }</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                   ])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>等价SQL</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> sum(amount)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> as total from orders </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        where</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">A</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        group</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> by</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cust_id</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        order</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> by</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> total</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> desc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示：aggregate统计分析，请参考后续章节。</p></div>`,15)]))}const p=s(n,[["render",l]]),d=JSON.parse('{"path":"/mongodb/%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93/","title":"聚合管道","lang":"zh-CN","frontmatter":{"title":"聚合管道","createTime":"2025/07/07 18:31:20","permalink":"/mongodb/聚合管道/","description":"本章节介绍MongoDB Aggregation Pipeline (聚合管道)，主要用于统计分析，类似SQL的group by语句，Mongo shell通过db.collection.aggregate()函数实现统计分析。 概念 聚合管道（Aggregation Pipeline）是一个抽象的概念，把数据比作管道中的水，水在管道中流动，然后我们就...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"聚合管道\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-29T16:03:14.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://docs.sreio.com/mongodb/%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93/"}],["meta",{"property":"og:site_name","content":"Sreio Docs"}],["meta",{"property":"og:title","content":"聚合管道"}],["meta",{"property":"og:description","content":"本章节介绍MongoDB Aggregation Pipeline (聚合管道)，主要用于统计分析，类似SQL的group by语句，Mongo shell通过db.collection.aggregate()函数实现统计分析。 概念 聚合管道（Aggregation Pipeline）是一个抽象的概念，把数据比作管道中的水，水在管道中流动，然后我们就..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-29T16:03:14.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-29T16:03:14.000Z"}]]},"readingTime":{"minutes":1.49,"words":446},"git":{"createdTime":1751885168000,"updatedTime":1767024194000,"contributors":[{"name":"sreio","username":"sreio","email":"ingwei@163.com","commits":3,"avatar":"https://avatars.githubusercontent.com/sreio?v=4","url":"https://github.com/sreio"}],"changelog":[{"hash":"6dd596b6752ea1c49be57e00b1b0c941c0324a5d","time":1767024194000,"email":"ingwei@163.com","author":"sreio","message":"feat: Add new documentation across Go, PHP, Docker, Linux, Database, Middleware, and Fundamentals, while removing some old images and files."},{"hash":"392e0717075550911bee8967562578d34bf94c89","time":1752462858000,"email":"ingwei@163.com","author":"sreio","message":"updated: fixed tip"},{"hash":"c1ab990bb57919c348cc77b4236368714def9959","time":1751885168000,"email":"ingwei@163.com","author":"sreio","message":"elk&#x26;clickhouse&#x26;redis&#x26;mongdb&#x26;etcd"}]},"autoDesc":true,"filePathRelative":"database/mongodb/5.聚合分析/1.pipeline.md","headers":[]}');export{p as comp,d as data};
