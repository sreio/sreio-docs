import{_ as i,c as a,e as n,o as l}from"./app-DWByWgeb.js";const e={};function h(p,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="linux相关知识点" tabindex="-1"><a class="header-anchor" href="#linux相关知识点"><span><strong>Linux相关知识点</strong></span></a></h2><ul><li><a href="#1">Nginx实现一个IP访问总流量限制</a></li><li><a href="#2">统计服务器所有url被请求的数量</a></li><li><a href="#3">查找请求数前20个IP</a></li><li><a href="#4">统计文件中某个字符串出现的次数</a></li><li><a href="#5">监听文件</a></li><li><a href="#6">查看文件大小</a></li><li><a href="#7">查看ip来源地</a></li><li><a href="#8">查看磁盘使用情况</a></li><li><a href="#9">创建软链接</a></li><li><a href="#10">查看是否监听xx端口</a></li><li><a href="#11">Nginx之解决跨域问题</a></li><li><a href="#12">Nginx之配置ssl</a></li><li><a href="#13">Nginx之开放防火墙端口</a></li><li><a href="#14">Linux之 cat 命令</a></li><li><a href="#15">Nginx之实现网络负载均衡</a></li><li><a href="#16">Linux之locate</a></li></ul><p><a name="1"></a></p><h2 id="_1-nginx实现一个ip访问总流量限制" tabindex="-1"><a class="header-anchor" href="#_1-nginx实现一个ip访问总流量限制"><span>1.Nginx实现一个IP访问总流量限制</span></a></h2><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">http</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> {</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    limit_conn_zone </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binary_remote_addr</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zone=conn_zone:10m</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    limit_req_zone </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binary_remote_addr</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zone=req_zone:10m rate=1r/s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 其他配置</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> {</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    listen </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">80</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    server_name </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">example.com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 限制单个客户端 IP 最大连接数为 2</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    limit_conn </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">conn_zone </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 限制单个客户端 IP 1s 内最多发起 1 个请求</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    limit_req </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">zone=req_zone burst=5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 计算客户端 IP 累计请求流量，限制累计请求流量为 1GB</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    set </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">limit_rate</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 128k</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    limit_rate_after </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">500M</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    limit_rate </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1m</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 其他处理逻辑</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="2"></a></p><h2 id="_2-统计服务器所有url被请求的数量" tabindex="-1"><a class="header-anchor" href="#_2-统计服务器所有url被请求的数量"><span>2.统计服务器所有url被请求的数量</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#统计其他端口时：netstat -pnt | grep :xx | wc -l</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">netstat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -pnt</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> :443</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> wc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -l</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="3"></a></p><h2 id="_3-查找请求数前20个ip" tabindex="-1"><a class="header-anchor" href="#_3-查找请求数前20个ip"><span>3.查找请求数前20个IP</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#服务器被恶意高频访问时可以用到</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">netstat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -ant</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">awk</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/:443/{split($5,ip,&quot;:&quot;);++A[ip[1]]}END{for(i in A) print A[i],i}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sort</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -rn</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">head</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="4"></a></p><h2 id="_4-统计文件中某个字符串出现的次数" tabindex="-1"><a class="header-anchor" href="#_4-统计文件中某个字符串出现的次数"><span>4.统计文件中某个字符串出现的次数</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#如统计文件api_error.log中error关键词出现的次数</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">grep</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -o</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">error</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /www/payment/runtime/logs/api_error.log</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> wc</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -l</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="5"></a></p><h2 id="_5-监听文件" tabindex="-1"><a class="header-anchor" href="#_5-监听文件"><span>5.监听文件</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#可以监听整个文件，也可根据关键词监听</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /www/payment/runtime/logs/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#-f 常用于查阅正在改变的日志文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xxx.log</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> #监听整个文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xxx.log</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">xxx</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> #根据关键词监听</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tail</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -Nf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xxx.log</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  #N为要查看的、最近多少条日志，例如tail -100f xxx.log 显示 xxx.log 里尾部100行的内容，且不断刷新。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="6"></a></p><h2 id="_6-查看文件大小" tabindex="-1"><a class="header-anchor" href="#_6-查看文件大小"><span>6.查看文件大小</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#以下是本人开发中常用到的</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">一、du命令</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">du命令是查看使用空间的，但是与df命令不同的是Linux</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> du命令是对文件和目录磁盘使用的空间的查看，还是和df命令有一些区别的。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">du</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -h</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filepath</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 直接得出人好识别的文件大小</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">du</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -h</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ljl.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">或者</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">du</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -ah</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 当前目录下所有文件的大小</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">二、ls命令</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ls命令用来显示目标列表，在Linux中是使用率较高的命令。ls命令的输出信息可以进行彩色加亮显示，以分区不同类型的文件。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -l</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filepath</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 第五列为文件字节数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -l</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ljl.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -h</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filepath</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> h表示human,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 加-h参数得到人好读的文件大小</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ls</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -lh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ljl.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="7"></a></p><h2 id="_7-查看ip来源地" tabindex="-1"><a class="header-anchor" href="#_7-查看ip来源地"><span>7.查看ip来源地</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#使用这个是为了查看异常登录地址</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yum</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> whois</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">whois</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 119.53.224.203</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="8"></a></p><h2 id="_8-查看磁盘使用情况" tabindex="-1"><a class="header-anchor" href="#_8-查看磁盘使用情况"><span>8. 查看磁盘使用情况</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">df</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a name="9"></a></p><h2 id="_9-创建软链接" tabindex="-1"><a class="header-anchor" href="#_9-创建软链接"><span>9.创建软链接</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [源文件或目录] </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">目标文件或目录</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">例如：创建软链时，先进入根目录的bin目录下</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">从/bin这个路径创建软链nginx</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 引入/usr/local/nginx/sbin/nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/nginx/sbin/nginx</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">创建软链之后</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 重载nginx</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">就可以从</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/local/nginx/sbin/nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 简化为</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="10"></a></p><h2 id="_10-查看是否监听9000端口-其他端口雷同" tabindex="-1"><a class="header-anchor" href="#_10-查看是否监听9000端口-其他端口雷同"><span>10.查看是否监听9000端口（其他端口雷同）</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">netstat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -ant</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 9000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a name="11"></a></p><h2 id="_11-nginx之-解决跨域问题" tabindex="-1"><a class="header-anchor" href="#_11-nginx之-解决跨域问题"><span>11.Nginx之 解决跨域问题</span></a></h2><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#server模块中添加以下内容，修改完后，记得重启nginx</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_header </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Access-Control-Allow-Headers </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&#39;*&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_header </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Access-Control-Allow-Origin </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&#39;*&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_header </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Access-Control-Allow-Credentials </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&#39;true&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_header </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Access-Control-Allow-Methods </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&#39;GET,POST,OPTIONS&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#跨域参数解释</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#Access-Control-Allow-Origin：服务器默认是不被允许跨域的。给Nginx服务器配置Access-Control-Allow-Origin *后，表示服务器可以接受所有的请求源(Origin),即接受所有跨域的请求。</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#Access-Control-Allow-Methods：允许通过的方法，可以防止Content-Type is not allowed by Access-Control-Allow-Headers in preflight response的错误信息</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#Access-Control-Allow-Credentials true 表示允许跨域请求携带 cookie</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#Access-Control-Allow-Headers：为了防止出现Request header field Content-Type is not allowed by Access-Control-Allow-Headers in preflight response的错误信息。这个错误表示当前请求Content-Type的值不被支持。其实是我们发起了”application/json”的类型请求导致的</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="12"></a></p><h2 id="_12-nginx之-配置ssl-小白看过来" tabindex="-1"><a class="header-anchor" href="#_12-nginx之-配置ssl-小白看过来"><span>12.Nginx之 配置ssl(小白看过来)</span></a></h2><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> {</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    listen </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">443</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ssl</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#监听443端口</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">	#server_name 购买域名后解析到该服务器上，如果没有域名，也可以给此项目单独开端口</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    server_name </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> api.applet.xxx.com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    root </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">       /xxx/xxxx/xxxx</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#root 项目地址</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    index </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">      index.php index.html index.htm</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#项目入口文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">	#存放证书的地址.pem和.key文件</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ssl_certificate </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/local/nginx/conf/vhost/cert/xxx.pem</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ssl_certificate_key </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/usr/local/nginx/conf/vhost/cert/xxx.key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ssl_session_timeout </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5m</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ssl_ciphers </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ssl_protocols </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TLSv1 TLSv1.1 TLSv1.2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ssl_prefer_server_ciphers on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">!-e </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">request_filename</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">){</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        rewrite</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ^/(.*) /index.php </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">last</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    location</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ~</span><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;"> \\.php$ </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">{</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            fastcgi_pass </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  127.0.0.1:9000</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            fastcgi_index </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> index.php</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            fastcgi_param </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SCRIPT_FILENAME  </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">document_root</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">$</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">fastcgi_script_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            include </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">       fastcgi_params</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    error_log </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> /var/log/nginx/api_applet.log </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">error</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="13"></a></p><h2 id="_13-nginx之-开放防火墙端口" tabindex="-1"><a class="header-anchor" href="#_13-nginx之-开放防火墙端口"><span>13.Nginx之 开放防火墙端口</span></a></h2><blockquote><p>紧接着上面的 12.Nginx配置ssl 中 server_name 提到的给项目开端口</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#这里讲到的是CentOS7,CentOS7的防火墙和CentOS6不一样了， CentOS 6 系列中的 iptables 相关命令不能用了，Centos7中使用firewalld代替了原来的iptables。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#停止firewall</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> firewalld.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#禁止firewall开机启动</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> disable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> firewalld.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#添加8022端口</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --zone=public</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --add-port=8022/tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#多个端口:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --zone=public</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --add-port=80-90/tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#命令含义：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">--zone</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> #作用域</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">--add-port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">8022/tcp</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> #添加端口，格式为：端口/通讯协议</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">--permanent</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> #永久生效，没有此参数重启后失效</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#centos7查看防火墙所有信息</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --list-all</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#centos7查看防火墙开放的端口信息</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --list-ports</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#删除8022端口</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --zone=public</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --remove-port=8022/tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#重启防火墙</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">常用命令介绍：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --state</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">                ##查看防火墙状态，是否是running</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --reload</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">               ##重新载入配置，比如添加规则之后，需要执行此命令</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --get-zones</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">            ##列出支持的zone</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --get-services</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         ##列出支持的服务，在列表中的服务是放行的</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --query-service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ftp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    ##查看ftp服务是否支持，返回yes或者no</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --add-service=ftp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      ##临时开放ftp服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --add-service=ftp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --permanent</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     ##永久开放ftp服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --remove-service=ftp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --permanent</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  ##永久移除ftp服务</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">firewall-cmd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --add-port=80/tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --permanent</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     ##永久添加80端口</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="14"></a></p><h2 id="_14-linux之-cat-命令" tabindex="-1"><a class="header-anchor" href="#_14-linux之-cat-命令"><span>14.Linux之 cat 命令</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#是不是以为cat只有 cat filename 这个命令？</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#不不不，它还可以更骚气。接下来介绍一下cat命令常用又不常用的命令</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">1.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 显示文件内容</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">使用cat命令可以打印出文件的内容，如：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filename</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">这将把文件的所有行打印到终端上。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">2.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 将多个文件合并</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">使用cat命令还可以将多个文件合并成一个文件，如：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file2</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">这将把file1和file2的内容合并成一个新文件file3。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">3.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 使用管道输出内容</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">在Linux环境下，使用管道可以将一个命令的输出作为另一个命令的输入，如：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filename</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> keyword</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">这将把filename文件中包含keyword的行输出。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">4.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 压缩文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat命令还可以用于压缩文件。将cat输出重定向到一个tar命令中，可以将文件压缩成一个tar文件，如：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file2</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> tar</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -czf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> archive.tar.gz</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">这将把file1和file2打包成一个tar文件，然后使用gzip进行压缩。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">5.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 重定向输出</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">使用重定向符号可以将cat命令的输出重定向到文件中，如：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filename</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> newfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">这将把filename的内容输出到newfile中，如果newfile不存在则会创建一个新的文件。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">6.反向输出</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#打印内容</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@VM-4-4-centos data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># cat 1.txt</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">我是第一行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">我是第二行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">我是第三行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#反向打印</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root@VM-4-4-centos data</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"># tac 1.txt</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">我是第三行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">我是第二行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">我是第一行</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="15"></a></p><h2 id="_15-nginx之-实现网络负载均衡" tabindex="-1"><a class="header-anchor" href="#_15-nginx之-实现网络负载均衡"><span>15. Nginx之 实现网络负载均衡</span></a></h2><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-nginx"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">nginx内置负载均衡策略主要分为三大类，分别是轮询、最少连接和ip</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> hash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 轮询</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">以循环方式分发对应用服务器的请求，将请求平均分发到每台服务器上。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1.1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 普通轮询方式</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">该方式是默认方式，轮询适合服务器配置相当，无状态且短平快的服务使用。另外在轮询中，如果服务器挂掉，会自动剔除该服务器。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">http {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 定义转发分配规则</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    upstream myapp1 {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        server baidu.com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 要转发到的服务器，如ip、ip:端口号、域名、域名:端口号</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> baidu2.com:8088;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 192.168.0.1:8088;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> {</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        listen </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">443</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # nginx监听的端口</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        location</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> / </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">{</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">            # 使用myapp1分配规则，即刚自定义添加的upstream节点</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">            # 将所有请求转发到myapp1服务器组中配置的某一台服务器上</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            proxy_pass </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">http://myapp1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    }</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1.2权重轮询方式</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">如果在 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">upstream</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 中配置的server参数后追加 weight 配置，则会根据配置的权重进行请求分发。此策略可以与least_conn和ip_hash结合使用，适合服务器的硬件配置差别比较大的情况。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 定义转发分配规则</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">upstream</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> myapp1 </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">{</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> baidu1.com </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">weight</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 该台服务器接受1/6的请求量</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	server baidu2.com:8088 </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">weight</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 该台服务器接受2/6的请求量</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	server 198.16.0.1:8088 </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">weight</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 该台服务器接受3/6的请求量;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">2. 最少连接</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">轮询算法是把请求平均的转发给各个后端，使它们的负载大致相同；但是，有些请求占用的时间很长，会导致其所在的后端负载较高。这种情况下，least_conn这种方式就可以达到更好的负载均衡效果，适合请求处理时间长短不一造成服务器过载的情况</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 定义转发分配规则</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">upstream myapp1 {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">	least_conn; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 把请求分派给连接数最少的服务器</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> baidu.com;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> baidu1.com:8088;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 192.168.0.100:8088;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">2.</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">3</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ip hash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">这个方法确保了相同的客户端的请求一直发送到相同的服务器，这样每个访客都固定访问一个后端服务器。如用户需要分片上传文件到服务器下，然后再由服务器将分片合并，这时如果用户的请求到达了不同的服务器，那么分片将存储于不同的服务器目录中，导致无法将分片合并，该场景则需要使用ip hash策略。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">需要注意的是，ip_hash不能与backup同时使用，另外当有服务器需要剔除，必须手动down掉，此模式适合有状态服务，比如session。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 定义转发分配规则</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">upstream</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> myapp1 </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">{</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	ip_hash</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # #保证每个请求固定访问一个后端服务器</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> srv1.com;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> srv2.com:8088;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">	server</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 192.168.0.100:8088;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="16"></a></p><h2 id="_16-linux之-locate" tabindex="-1"><a class="header-anchor" href="#_16-linux之-locate"><span>16. Linux之 locate</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#命令简介</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">locate(locate</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) 命令用来查找文件或目录。 要比find -name快得多，原因在于它不搜索具体目录，而是搜索一个数据库/var/lib/mlocate/mlocate.db 。这个数据库中含有本地所有文件信息。Linux系统自动创建这个数据库, 并且每天自动更新一次，因此，我们在用whereis和locate 查找文件时，有时会找到已经被删除的数据，或者刚刚建立文件，却无法查找到，原因就是因为数据库文件没有被更新。为了避免这种情况，可以在使用locate之前，先使用updatedb命令，手动更新数据库。整个locate工作其实是由四部分组成的:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">1.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  /usr/bin/updatedb  </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          主要用来更新数据库，通过crontab自动完成的</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">2.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  /usr/bin/locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">              查询文件位置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">3.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  /etc/updatedb.conf  </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         updatedb的配置文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">4.</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  /var/lib/mlocate/mlocate.db </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 存放文件信息的文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#用法</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#一般情况我们只需要输入 locate your_file_name 即可查找指定文件。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">locate</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [OPTION]... </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PATTERN</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-b,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --basename</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 仅匹配路径名的基本名称</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-c,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --count</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 只输出找到的数量</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-d,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --database</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DBPATH</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 使用</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DBPATH</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 指定的数据库，而不是默认数据库</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /var/lib/mlocate/mlocate.db</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-e,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --existing</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 仅打印当前现有文件的条目</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-1</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">   --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 如果</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 是</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1．则启动安全模式。在安全模式下，使用者不会看到权限无法看到</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 的档案。这会始速度减慢，因为</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 必须至实际的档案系统中取得档案的</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 权限资料。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-0,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --null</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 在输出上带有NUL的单独条目</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-S,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --statistics</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 不搜索条目，打印有关每个数据库的统计信息</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-q</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">   --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 安静模式，不会显示任何错误讯息。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-P,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --nofollow,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -H</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 检查文件存在时不要遵循尾随的符号链接</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-l,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --limit,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LIMIT</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 将输出（或计数）限制为LIMIT个条目</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-n</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">   --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 至多显示</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> n个输出。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-m,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --mmap</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 被忽略，为了向后兼容</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-r,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --regexp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> REGEXP</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 使用基本正则表达式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">     --regex</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 使用扩展正则表达式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-q,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --quiet</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 安静模式，不会显示任何错误讯息</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-s,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --stdio</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 被忽略，为了向后兼容</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-o,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 指定资料库存的名称。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-h,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --help</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 显示帮助</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-i,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --ignore-case</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 忽略大小写</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-V,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --version</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 显示版本信息</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 实例</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#查找 php.ini 文件，输入以下命令：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> php.ini</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">搜索</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> etc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 目录下所有以</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 开头的文件</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">忽略大小写搜索当前用户目录下所有以</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 开头的文件</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">locate</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/r</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 附加说明</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">1.locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 与</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> find</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 不同:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> find</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 是去硬盘找，locate只在资料库中找。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">2.locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 的速度比</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> find</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 快，它并不是真的查找，而是查数据库，一般文件数据库在</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /var/lib/mlocate/mlocate.db</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 中，所以</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> locate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 的查找并不是实时的，而是以数据库的更新为准，一般是系统自己维护，也可以手工升级数据库</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ，命令为：</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> updatedb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,51)]))}const t=i(e,[["render",h]]),d=JSON.parse('{"path":"/interview/nginx/","title":"nginx","lang":"zh-CN","frontmatter":{"title":"nginx","createTime":"2025/07/07 16:41:07","permalink":"/interview/nginx/","description":"Linux相关知识点 Nginx实现一个IP访问总流量限制 统计服务器所有url被请求的数量 查找请求数前20个IP 统计文件中某个字符串出现的次数 监听文件 查看文件大小 查看ip来源地 查看磁盘使用情况 创建软链接 查看是否监听xx端口 Nginx之解决跨域问题 Nginx之配置ssl Nginx之开放防火墙端口 Linux之 cat 命令 Ngi...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"nginx\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-07-07T08:44:18.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://docs.sreio.com/interview/nginx/"}],["meta",{"property":"og:site_name","content":"Sreio Docs"}],["meta",{"property":"og:title","content":"nginx"}],["meta",{"property":"og:description","content":"Linux相关知识点 Nginx实现一个IP访问总流量限制 统计服务器所有url被请求的数量 查找请求数前20个IP 统计文件中某个字符串出现的次数 监听文件 查看文件大小 查看ip来源地 查看磁盘使用情况 创建软链接 查看是否监听xx端口 Nginx之解决跨域问题 Nginx之配置ssl Nginx之开放防火墙端口 Linux之 cat 命令 Ngi..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-07T08:44:18.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-07T08:44:18.000Z"}]]},"readingTime":{"minutes":11.54,"words":3461},"git":{"createdTime":1751877858000,"updatedTime":1751877858000,"contributors":[{"name":"sreio","username":"sreio","email":"ingwei@163.com","commits":1,"avatar":"https://avatars.githubusercontent.com/sreio?v=4","url":"https://github.com/sreio"}],"changelog":[{"hash":"5be24b01f97e53b886885abde519c2e0cc6b3447","time":1751877858000,"email":"ingwei@163.com","author":"sreio","message":"面试"}]},"autoDesc":true,"filePathRelative":"interview/服务器/1.nginx.md","headers":[]}');export{t as comp,d as data};
