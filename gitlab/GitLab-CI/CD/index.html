<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.23" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.155" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"GitLab-CI/CD","image":[""],"dateModified":"2025-12-29T16:03:14.000Z","author":[]}</script><meta property="og:url" content="https://docs.sreio.com/gitlab/GitLab-CI/CD/"><meta property="og:site_name" content="Sreio Docs"><meta property="og:title" content="GitLab-CI/CD"><meta property="og:description" content="转自Gitlab-CICD最简单明了的入门教程 CICD是什么? 由于目前公司使用的gitlab，大部分项目使用的CICD是gitlab的CICD，少部分用的是jenkins，使用了gitlab-ci一段时间后感觉还不错，因此总结一下 介绍gitlab的CICD之前，可以先了解CICD是什么 我们的开发模式经历了如下的转变：瀑布模型->敏捷开发→Dev..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-12-29T16:03:14.000Z"><meta property="article:modified_time" content="2025-12-29T16:03:14.000Z"><link rel="icon" type="image/png" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6715279698150024" crossorigin="anonymous"></script><title>GitLab-CI/CD | Sreio Docs</title><meta name="description" content="转自Gitlab-CICD最简单明了的入门教程 CICD是什么? 由于目前公司使用的gitlab，大部分项目使用的CICD是gitlab的CICD，少部分用的是jenkins，使用了gitlab-ci一段时间后感觉还不错，因此总结一下 介绍gitlab的CICD之前，可以先了解CICD是什么 我们的开发模式经历了如下的转变：瀑布模型->敏捷开发→Dev..."><link rel="preload" href="/assets/style-BXtE0-vj.css" as="style"><link rel="stylesheet" href="/assets/style-BXtE0-vj.css"><link rel="modulepreload" href="/assets/app-DWByWgeb.js"><link rel="modulepreload" href="/assets/index.html-idmrLznS.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-d90a7a26><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d5a8d0bc></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-d5a8d0bc> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-d90a7a26 data-v-e98a6132><div class="vp-navbar" vp-navbar data-v-e98a6132 data-v-2c31ea5e><div class="wrapper" data-v-2c31ea5e><div class="container" data-v-2c31ea5e><div class="title" data-v-2c31ea5e><div class="vp-navbar-title has-sidebar" data-v-2c31ea5e data-v-1a4f50af><a class="vp-link link no-icon title" href="/" data-v-1a4f50af><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="/favicon.ico" alt data-v-480e858a><!--]--><!--[--><img class="vp-image light logo" style="" src="/favicon.ico" alt data-v-480e858a><!--]--><!--]--><!--]--><span data-v-1a4f50af>Sreio Docs</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-2c31ea5e><div class="content-body" data-v-2c31ea5e><!--[--><!--]--><div class="vp-navbar-search search" data-v-2c31ea5e><div class="search-wrapper" data-v-97535d1e><!----><div id="local-search" data-v-97535d1e><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-97535d1e><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-2c31ea5e data-v-d43c1732><span id="main-nav-aria-label" class="visually-hidden" data-v-d43c1732>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>首页</span><!----><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-86530b6c><span class="text" data-v-86530b6c><!----><!----><span data-v-86530b6c>编程语言</span><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/golang/" data-v-1ff1855f><!--[--><!----> Golang <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/php/" data-v-1ff1855f><!--[--><!----> PHP <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-86530b6c><span class="text" data-v-86530b6c><!----><!----><span data-v-86530b6c>数据库</span><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/mysql/" data-v-1ff1855f><!--[--><!----> MySQL <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/redis/" data-v-1ff1855f><!--[--><!----> Redis <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/mongodb/" data-v-1ff1855f><!--[--><!----> MongoDB <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/clickhouse/" data-v-1ff1855f><!--[--><!----> ClickHouse <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/etcd/" data-v-1ff1855f><!--[--><!----> Etcd <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-86530b6c><span class="text" data-v-86530b6c><!----><!----><span data-v-86530b6c>DevOps</span><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/docker/" data-v-1ff1855f><!--[--><!----> Docker <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/k8s/" data-v-1ff1855f><!--[--><!----> Kubernetes <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/linux/" data-v-1ff1855f><!--[--><!----> Linux <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/nginx/" data-v-1ff1855f><!--[--><!----> Nginx <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/ELK/" data-v-1ff1855f><!--[--><!----> ELK <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/git/" data-v-1ff1855f><!--[--><!----> Git <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/gitlab/" data-v-1ff1855f><!--[--><!----> GitLab <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-86530b6c><span class="text" data-v-86530b6c><!----><!----><span data-v-86530b6c>中间件</span><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/queue/" data-v-1ff1855f><!--[--><!----> 消息队列 <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-86530b6c><span class="text" data-v-86530b6c><!----><!----><span data-v-86530b6c>基础知识</span><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/brain/" data-v-1ff1855f><!--[--><!----> 数据结构与算法 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/network/" data-v-1ff1855f><!--[--><!----> 网络协议 <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-86530b6c><span class="text" data-v-86530b6c><!----><!----><span data-v-86530b6c>更多</span><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/ai/" data-v-1ff1855f><!--[--><!----> AI <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/interview/" data-v-1ff1855f><!--[--><!----> 面试宝典 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/it/" data-v-1ff1855f><!--[--><!----> IT 名词 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/cpwp/" data-v-1ff1855f><!--[--><!----> 程序员发音 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/vpn/" data-v-1ff1855f><!--[--><!----> VPN <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/%E9%A9%BE%E7%85%A7%E8%80%83%E8%AF%95/" data-v-1ff1855f><!--[--><!----> 驾照考试 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-1ff1855f><a class="vp-link link" href="/sites/" data-v-1ff1855f><!--[--><!----> 网站导航 <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!--[--><!--]--><!----><div class="vp-navbar-appearance appearance" data-v-2c31ea5e data-v-a295abf6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a295abf6 data-v-596c25a9 data-v-7eb32327><span class="check" data-v-7eb32327><span class="icon" data-v-7eb32327><!--[--><span class="vpi-sun sun" data-v-596c25a9></span><span class="vpi-moon moon" data-v-596c25a9></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-2c31ea5e data-v-ad52545c data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/sreio/sreio-docs" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-2c31ea5e data-v-652282fd data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-86530b6c><span class="vpi-more-horizontal icon" data-v-86530b6c></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><!----><!--[--><!--[--><!----><div class="group" data-v-652282fd><div class="item appearance" data-v-652282fd><p class="label" data-v-652282fd>外观</p><div class="appearance-action" data-v-652282fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-652282fd data-v-596c25a9 data-v-7eb32327><span class="check" data-v-7eb32327><span class="icon" data-v-7eb32327><!--[--><span class="vpi-sun sun" data-v-596c25a9></span><span class="vpi-moon moon" data-v-596c25a9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-652282fd><div class="item social-links" data-v-652282fd><div class="vp-social-links social-links-list" data-v-652282fd data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/sreio/sreio-docs" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-2c31ea5e data-v-2b50024d><span class="container" data-v-2b50024d><span class="top" data-v-2b50024d></span><span class="middle" data-v-2b50024d></span><span class="bottom" data-v-2b50024d></span></span></button></div></div></div></div><div class="divider" data-v-2c31ea5e><div class="divider-line" data-v-2c31ea5e></div></div></div><!----></header><div class="vp-local-nav reached-top" data-v-d90a7a26 data-v-3944d8e8><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-3944d8e8><span class="vpi-align-left menu-icon" data-v-3944d8e8></span><span class="menu-text" data-v-3944d8e8>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-3944d8e8 data-v-4114a62c><button data-v-4114a62c>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-d90a7a26 data-v-95211354><div class="curtain" data-v-95211354></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-95211354><span id="sidebar-aria-label" class="visually-hidden" data-v-95211354> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 has-active" data-v-473fd05b data-v-12048f0f><!----><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/gitlab/GitLab-CI/CD/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>GitLab-CI/CD</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-d90a7a26 data-v-b2beaca7><div class="vp-doc-container has-sidebar has-aside" data-v-b2beaca7 data-v-23f6ad98><!--[--><!--]--><div class="container" data-v-23f6ad98><div class="aside" vp-outline data-v-23f6ad98><div class="aside-curtain" data-v-23f6ad98></div><div class="aside-container" data-v-23f6ad98><div class="aside-content" data-v-23f6ad98><div class="vp-doc-aside" data-v-23f6ad98 data-v-5976474c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-5976474c data-v-aa56eba0><div class="content" data-v-aa56eba0><div class="outline-marker" data-v-aa56eba0></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-aa56eba0><span data-v-aa56eba0>此页内容</span><span class="vpi-print icon" data-v-aa56eba0></span></div><ul class="root" data-v-aa56eba0 data-v-3e6b023c><!--[--><!--]--></ul></div></nav><!--[--><!--[--><!--[--><!--[--><div class="aside-nav-wrapper" data-v-d90a7a26 data-v-45e94c4e><a class="vp-link link no-icon link" href="https://github.com/sreio/sreio-docs" target="_blank" rel="noreferrer" data-v-45e94c4e><!--[--><span class="vpi-github-star" data-v-45e94c4e></span><span class="link-text" data-v-45e94c4e>在 GitHub 上 Star</span><span class="vpi-arrow-right" data-v-45e94c4e></span><!--]--><!----></a><a class="vp-link link no-icon link" href="https://github.com/sreio/sreio-docs/issues/new/choose" target="_blank" rel="noreferrer" data-v-45e94c4e><!--[--><span class="vpi-github-issue" data-v-45e94c4e></span><span class="link-text" data-v-45e94c4e>遇到问题？</span><span class="vpi-arrow-right" data-v-45e94c4e></span><!--]--><!----></a></div><!--]--><!--]--><!--]--><!--]--><div class="spacer" data-v-5976474c></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-23f6ad98><div class="content-container" data-v-23f6ad98><!--[--><!--]--><main class="main" data-v-23f6ad98><nav class="vp-breadcrumb" data-v-23f6ad98 data-v-1ae4ad7a><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-1ae4ad7a><!--[--><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link link breadcrumb" href="/" property="item" typeof="WebPage" data-v-1ae4ad7a><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-1ae4ad7a></span><meta property="name" content="首页" data-v-1ae4ad7a><meta property="position" content="1" data-v-1ae4ad7a></li><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link link breadcrumb current" href="/gitlab/GitLab-CI/CD/" property="item" typeof="WebPage" data-v-1ae4ad7a><!--[-->GitLab-CI/CD<!--]--><!----></a><!----><meta property="name" content="GitLab-CI/CD" data-v-1ae4ad7a><meta property="position" content="2" data-v-1ae4ad7a></li><!--]--></ol></nav><!--[--><!--]--><!--[--><h1 class="vp-doc-title page-title" data-v-27be53cb>GitLab-CI/CD <!----></h1><div class="vp-doc-meta" data-v-27be53cb><!--[--><!--]--><p class="reading-time" data-v-27be53cb><span class="vpi-books icon" data-v-27be53cb></span><span data-v-27be53cb>约 4699 字</span><span data-v-27be53cb>大约 16 分钟</span></p><!----><!--[--><!--]--><p class="create-time" data-v-27be53cb><span class="vpi-clock icon" data-v-27be53cb></span><span data-v-27be53cb>2025-07-07</span></p></div><!--]--><!--[--><!--]--><div class="_gitlab_GitLab-CI_CD_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-23f6ad98><!--[--><!--]--><div data-v-23f6ad98><div class="hint-container tip"><p class="hint-container-title">转自<a href="https://www.cnblogs.com/mrxccc/p/16504723.html" target="_blank" rel="noopener noreferrer">Gitlab-CICD最简单明了的入门教程</a></p></div><h2 id="cicd是什么" tabindex="-1"><a class="header-anchor" href="#cicd是什么"><span>CICD是什么?</span></a></h2><p>由于目前公司使用的gitlab，大部分项目使用的CICD是gitlab的CICD，少部分用的是jenkins，使用了gitlab-ci一段时间后感觉还不错，因此总结一下</p><p>介绍gitlab的CICD之前，可以先了解CICD是什么</p><p>我们的开发模式经历了如下的转变：瀑布模型-&gt;敏捷开发→DevOps(Development、Operations的组合词，是一组过程、方法与系统的统称)</p><p>后来随着DevOps的兴起，出现了持续集成（Continuous Integration）、持续交付（Continuous Delivery） 、持续部署（Continuous Deployment） 的新方法，关于持续集成、持续交付、持续部署，总结如下：</p><ul><li><code>持续集成</code>的重点是将各个开发人员的工作集合到一个代码仓库中。通常，每天都要进行几次，主要目的是尽早发现集成错误，使团队更加紧密结合，更好地协作。</li><li><code>持续交付</code>的目的是最小化部署或释放过程中固有的摩擦。它的实现通常能够将构建部署的每个步骤自动化，以便任何时刻能够安全地完成代码发布（理想情况下）。</li><li><code>持续部署</code>是一种更高程度的自动化，无论何时对代码进行重大更改，都会自动进行构建/部署。</li></ul><h3 id="持续集成的好处是什么" tabindex="-1"><a class="header-anchor" href="#持续集成的好处是什么"><span>持续集成的好处是什么？</span></a></h3><p>持续集成可以使问题尽早暴露，从而也降低了解决问题的难度，正如老马所说，持续集成无法消除bug，但却能大大降低修复的难度和时间。</p><h3 id="持续交付的好处是什么" tabindex="-1"><a class="header-anchor" href="#持续交付的好处是什么"><span>持续交付的好处是什么？</span></a></h3><p>持续交付的好处在于快速获取用户反馈；适应市场变化和商业策略的变化。开发团队保证每次提交的修改都是可上线的修改，那么决定何时上线，上线哪部分功能则完全由产品业务团队决定。</p><p>虽然持续交付有显著的优点，但也有不成立的时候，比如对于嵌入式系统的开发，往往需要软硬件的配合。</p><h3 id="持续部署的好处是什么" tabindex="-1"><a class="header-anchor" href="#持续部署的好处是什么"><span>持续部署的好处是什么？</span></a></h3><p>持续部署的目标是通过减少批量工作的大小，并加快团队工作的节奏，帮助开发团队在其开发流程中消除浪费。这使团队能够一直处于一种可持续的平稳流状态， 让团队更容易去创新、试验，并达到可持续的生产率</p><p>市面上的CI有很多，如果在github上搜一下ci工具，也会搜到很多，比如：</p><ul><li>Travis CI</li><li>Circle CI</li><li>Jenkins</li><li>AppVeyor</li><li>CodeShip</li><li>Drone</li><li>Semaphore CI</li><li>Buildkite</li><li>Wercker</li><li>TeamCity</li></ul><p>这里只介绍Gitlab-CI</p><h2 id="gitlab-ci" tabindex="-1"><a class="header-anchor" href="#gitlab-ci"><span>Gitlab-CI</span></a></h2><figure><img src="/assets/gitlab_logo-5HawMasZ.png" alt="1-1" tabindex="0" loading="lazy" width="489" height="154"><figcaption>1-1</figcaption></figure><ul><li><p>项目页面：https://about.gitlab.com/product/continuous-integration/</p></li><li><p>源代码：https://gitlab.com/gitlab-org/gitlab-ce/</p></li><li><p>遵循 MIT 许可协议</p></li></ul><p>GitLab 是 CI/CD 领域的一个新手玩家，但它已经在 Forrester Wave 持续集成工具中占据了领先地位。在这样一个竞争对手众多而水平又很高的领域，这是一项巨大的成就。是什么让 GitLab CI 如此了不起？</p><ul><li>它使用 YAML 文件来描述整个管道。</li><li>它还有一个功能叫 Auto DevOps，使比较简单的项目可以自动构建内置了若干测试的管道。</li><li>使用 Herokuish 构建包来确定语言以及如何构建应用程序。有些语言还可以管理数据库，对于构建新的应用程序并在开发过程一开始就将其部署到生产环境中，这是一个很重要的功能。</li><li>提供到 Kubernetes 集群的原生集成，并使用多种部署方法的一种（如基于百分比的部署和蓝绿部署）将应用程序自动部署到 Kubernetes 集群中。</li></ul><p>除了 CI 功能之外，GitLab 还提供了许多补充功能，比如自动把 Prometheus 和你的应用程序一起部署，实现运行监控；使用 GitLab 问题（Issues）、史诗（Epics）和里程碑（Milestones）进行项目组合和项目管理；管道内置了安全检查，提供跨多个项目的聚合结果；使用 WebIDE 在 GitLab 中编辑代码的能力，它甚至可以提供预览或执行管道的一部分，以获得更快的反馈。</p><h3 id="相关概念" tabindex="-1"><a class="header-anchor" href="#相关概念"><span>相关概念</span></a></h3><h4 id="pipeline-管道、流水线" tabindex="-1"><a class="header-anchor" href="#pipeline-管道、流水线"><span>pipeline（管道、流水线）</span></a></h4><ul><li>一次 Pipeline 其实相当于一次构建任务，里面可以包含多个流程（<code>Stage</code>），比如自动构建、自动进行单元测试、自动进行代码检查等流程 ;</li><li>任何提交或者 Merge Request 的合并都可以触发 Pipeline ;</li></ul><h4 id="stage-构建阶段" tabindex="-1"><a class="header-anchor" href="#stage-构建阶段"><span>Stage（构建阶段）</span></a></h4><ul><li>Stage表示构建阶段，就是上面提到的流程 ;</li><li>可以在一次 <code>Pipeline</code> 中定义多个 <code>Stage</code>;</li><li>Stage有如下特点 : <ul><li>所有 stages 会按照顺序运行，即当一个 stage 完成后，下一个 Stage才会开始</li><li>只有当所有 Stage 成功完成后，该构建任务 <code>Pipeline</code> 才算成功</li><li>如果任何一个 Stage失败，那么后面的 Stage 不会执行，该构建任务 (Pipeline) 失败</li></ul></li></ul><p>阶段是对批量的作业的一个逻辑上的划分，每个 <code>pipeline</code> 都必须包含至少一个 <code>Stage</code>。多个 Stage是按照顺序执行的，如果其中任何一个 Stage失败，则后续的 Stage不会被执行，整个 CI 过程被认为失败。</p><h4 id="jobs-任务" tabindex="-1"><a class="header-anchor" href="#jobs-任务"><span>Jobs（任务）</span></a></h4><ul><li>job表示构建工作，表示某个stage里面执行的工作 ;</li><li>一个stage里面可以定义多个job ;</li><li>jobs有如下特点 : <ul><li>相同 stage 中的jobs 会并行执行</li><li>相同 stage 中的 jobs 都执行成功时，该 stage 才会成功</li><li>如果任何一个job 失败，那么该 stage 失败，即该构建任务 (Pipeline) 失败</li></ul></li></ul><p>举一个例子，比如下面这个图：</p><figure><img src="/assets/job_1-BTNOKsc8.png" alt="job-1" tabindex="0" loading="lazy" width="959" height="191"><figcaption>job-1</figcaption></figure><p>这里的四个Statge(阶段): <code>Verify</code>、<code>Build</code>、<code>Dockerpush</code>、<code>Deploy</code>四个，这四个阶段组成一条<code>Pipeline</code></p><p>每个阶段都有一个job，所以总共四个job，也就是<code>unit-test</code>、<code>java-package</code>、<code>docker-push</code>、<code>service-1</code>这四个，当然，每个stage可以由多个job组成，比如下面这个图：</p><p>Job 的执行过程中往往会产生一些数据，默认情况下 GitLab Runner 会保存 Job 生成的这些数据，然后在下一个 Job 执行之前（甚至不局限于当次 CI/CD）将这些数据恢复。这样即便是不同的 Job 运行在不同的 Runner 上，它也能看到彼此生成的数据。</p><p><code>.gitlab-ci.yml</code>中提供了 before_script 和 after_script 两个全局配置项。这两个配置项在所有 Job 的 script 执行前和执行后调用。</p><blockquote><p>关于.gitlab-ci.yml、before_script、after_script是什么，先别急，在后面有介绍</p></blockquote><p>在了解了 Job 配置的 script、before_script、after_script 和 cache 以后，可以将整个 Job 的执行流程用一张图概括：</p><figure><img src="/assets/job_2-rGv-hRDP.png" alt="job-2" tabindex="0" loading="lazy" width="1000" height="750"><figcaption>job-2</figcaption></figure><p>所以了解了Pipeline、Stage、Jobs后，还有一个很重要的东西，就是<code>Runner</code></p><h4 id="runner" tabindex="-1"><a class="header-anchor" href="#runner"><span>Runner</span></a></h4><p>Runner就像一个个的工人，而Gitlab-CI就是这些工人的一个管理中心，所有工人都要在Gitlab-CI里面登记注册，并且表明自己是为哪个工程服务的。当相应的工程发生变化时，Gitlab-CI就会通知相应的工人执行软件集成脚本。如下图所示：</p><figure><img src="/assets/runner_01-C45K5xVy.png" alt="runner-1" tabindex="0" loading="lazy" width="719" height="585"><figcaption>runner-1</figcaption></figure><p>gitlab里面的runner叫<code>Gitlab-Runner</code>，Gitlab-Runner是配合Gitlab-CI进行使用的。一般地，Gitlab里面的每一个工程都会定义一个属于这个工程的软件集成脚本，用来自动化地完成一些软件集成工作。当这个工程的仓库代码发生变动时，比如有人push了代码，GitLab就会将这个变动通知Gitlab-CI。这时Gitlab-CI会找出与这个工程相关联的Runner，并通知这些Runner把代码更新到本地并执行预定义好的执行脚本(也就是在<code>Job执行流程</code>那个图中所示的第三步：script)，所以，Gitlab-Runner就是一个用来执行软件集成脚本<code>script</code>的东西。</p><p>Runner类型</p><p>Gitlab-Runner可以分类两种类型：<strong>Shared Runner（共享型)</strong> 和 <strong>Specific Runner （指定型)</strong>。</p><ul><li>Shared Runner：这种Runner（工人）是所有工程都能够用的。只有系统管理员能够创建Shared Runner。</li><li>Specific Runner：这种Runner（工人）只能为指定的工程服务。拥有该工程访问权限的人都能够为该工程创建Shared Runner。</li></ul><p>关于Gitlab-runner的安装，会以单独一个文章进行介绍，注册runner会对应一个tag，记住这个tag；</p><h4 id="gitlab-ci-yml简介" tabindex="-1"><a class="header-anchor" href="#gitlab-ci-yml简介"><span>.gitlab-ci.yml简介</span></a></h4><p>.gitlab-ci.yml 文件被用来管理项目的 runner 任务，Gitlab CI通过.gitlab-ci.yml文件管理配置job，该文件定义了statge顺序、job应该如何触发和工作、执行什么脚本、如何构建pipeline等流程</p><blockquote><p>该文件存放于仓库的根目录, 默认名为<code>.gitlab-ci.yml</code></p></blockquote><p>我们先看一个简单的例子：.gitlab-ci.yml</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 定义pipeline流程：verify-&gt;build-&gt;dockerpush-&gt;deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">stages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#单元测试</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">unit-test</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 属于哪个流程</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 在哪个runner上面执行，在注册runner可以自定义</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo unit-test</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 执行脚本</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#java编译</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">java-package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#push镜像</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">docker-push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo docker-push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">service-1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo deploy</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置对应下面的pipeline，<code>test-cicd</code>是一个<code>Specific Runner</code>，执行脚本的类型是<code>shell</code></p><figure><img src="/assets/job_1-BTNOKsc8.png" alt="yml_1" tabindex="0" loading="lazy" width="959" height="191"><figcaption>yml_1</figcaption></figure><p>所以，以<code>unit-test</code>这个job为例，点击该任务可以进入到log界面查看整个log执行流程</p><figure><img src="/assets/yml_2-DfadbvaY.png" alt="yml_2" tabindex="0" loading="lazy" width="920" height="181"><figcaption>yml_2</figcaption></figure><figure><img src="/assets/yml_3-CUgIs4Du.png" alt="yml_3" tabindex="0" loading="lazy" width="875" height="427"><figcaption>yml_3</figcaption></figure><p>剩下的job的执行日志都大部分如此，就不一一列举了</p><h4 id="几个重要的关键字解析" tabindex="-1"><a class="header-anchor" href="#几个重要的关键字解析"><span>几个重要的关键字解析</span></a></h4><p>关于gitlab-ci.yml，里面有很多关键字配置，下面我主要列举一些比较常用的关键字</p><h5 id="before-script和after-script" tabindex="-1"><a class="header-anchor" href="#before-script和after-script"><span>before_script和after_script</span></a></h5><p>随着项目越来越大，Job 越来越多，Job 中包含的重复逻辑可能会让配置文件臃肿不堪。.gitlab-ci.yml 中提供了 <code>before_script</code> 和 <code>after_script</code> 两个全局配置项。这两个配置项在所有 Job 的 <code>script</code> 执行前和执行后调用。</p><p><code>before_script</code> 和 <code>script</code> 在一个上下文中是串行执行的，<code>after_script</code> 是独立执行的。所以根据执行器(在runner注册的时候，可以选择执行器，docker,shell 等)的不同，工作树之外的变化可能不可见，例如，在<code>before_script</code>中执行软件的安装。</p><p>你可以在任务中定义 <code>before_script</code>，<code>after_script</code>，也可以将其定义为顶级元素，定义为顶级元素将为每一个任务都执行相应阶段的脚本或命令。</p><h5 id="stages" tabindex="-1"><a class="header-anchor" href="#stages"><span>stages</span></a></h5><p>stages的允许定义多个，灵活的场景阶段的pipline。定义的元素的顺序决定了任务执行的顺序。例如：</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 定义pipeline流程：verify-&gt;build-&gt;dockerpush-&gt;deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">stages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>build场景的任务将被并行执行。test、deploy 同理</li><li>build 任务成功后，test 执行。test 成功后，deploy 执行</li><li>所有的都成功了，提交将会标记为成功</li><li>任何一步任务失败了，提交标记为失败并之后的场景，任务都不回执行。</li></ul><h5 id="tags" tabindex="-1"><a class="header-anchor" href="#tags"><span>tags</span></a></h5><p>tags可以从允许运行此项目的所有Runners中选择特定的Runners来执行jobs。</p><p>在注册Runner的过程中，我们可以设置Runner的标签，tags可通过tags来指定特殊的Runners来运行jobs：</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#单元测试</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">unit-test</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 属于哪个流程</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 在哪个runner上面执行，在注册runner可以自定义</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="script" tabindex="-1"><a class="header-anchor" href="#script"><span>script</span></a></h5><p>script是一段由Runner执行的shell脚本，可以执行多个，例如：</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mvn clean test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这个参数也可以使用数组包含好几条命令</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pwd</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mvn clean test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="only-and-except" tabindex="-1"><a class="header-anchor" href="#only-and-except"><span>only and except</span></a></h5><p>only和except两个参数说明了job什么时候将会被创建:</p><ul><li>only定义了job需要执行的所在分支或者标签</li><li>except定义了job不会执行的所在分支或者标签</li></ul><p>以下是这两个参数的几条用法规则：</p><ul><li><code>only</code>和<code>except</code>如果都存在在一个<code>job</code>声明中，则所需引用将会被<code>only</code>和<code>except</code>所定义的分支过滤.</li><li><code>only</code>和<code>except</code>允许使用正则</li><li><code>only</code>和<code>except</code>可同时使用。如果<code>only</code>和<code>except</code>在一个<code>job</code>配置中同时存在，则以<code>only</code>为准，跳过<code>except</code>(从下面示例中得出)。</li><li><code>only</code>和<code>except</code>允许使用特殊的关键字：<code>branches</code>，<code>tags</code>和<code>triggers</code>。</li><li><code>only</code>和<code>except</code>允许使用指定仓库地址但不是forks的仓库(查看示例3)。</li></ul><p>例子解析：</p><p>1.job将会只在issue-开头的refs下执行，反之则其他所有分支被跳过：</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # use regexp</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    only</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /^issue-.*$/</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # use special keyword</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    except</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> branches</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.job只会在打了tag的分支，或者被api所触发，或者每日构建任务上运行</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # use special keywords</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    only</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tags</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      # tag 分支 commit 之后触发</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> triggers</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # API 触发</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> schedules</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 每日构建触发</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.job将会在父仓库gitlab-org/gitlab-ce的非master分支有提交时运行。</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    only</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> branches@gitlab-org/gitlab-ce</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    except</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master@gitlab-org/gitlab-ce</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="when" tabindex="-1"><a class="header-anchor" href="#when"><span>when</span></a></h5><p>when可以设置以下值：</p><ol><li><code>on_success</code> - 只有前面stages的所有工作成功时才执行。 这是默认值。</li><li><code>on_failure</code> - 当前面stages中任意一个jobs失败后执行。</li><li><code>always</code> - 无论前面stages中jobs状态如何都执行。</li><li><code>manual</code> - 手动执行(GitLab8.10增加)。</li></ol><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">stages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup_build</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">build_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> make build</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cleanup_build_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup_build</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup build when failed</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on_failure</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">test_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> make test</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">deploy_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> make deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> manual</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cleanup_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup after jobs</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> always</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="脚本说明" tabindex="-1"><a class="header-anchor" href="#脚本说明"><span>脚本说明：</span></a></h6><ul><li>只有当build_job失败的时候才会执行`cleanup_build_job 。</li><li>不管前一个job执行失败还是成功都会执行`cleanup_job 。</li><li>可以从GitLab界面中手动执行deploy_jobs。</li></ul><h6 id="manual" tabindex="-1"><a class="header-anchor" href="#manual"><span>manual：</span></a></h6><ul><li>在GitLab的用户界面中显示该作业的“播放”按钮</li><li>意味着deploy_job仅在单击“播放”按钮时才会触发job。</li></ul><p>修改上面那个例子</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">stages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">before_script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pwd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">after_script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo after_script</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#单元测试</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">unit-test</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo unit-test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#java编译</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">java-package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#push镜像</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">docker-push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo docker-push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">service-1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> manual</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 手动触发job，只有点击按钮才会触发</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cleanup_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo clean up</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> always</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 前面的job成功与否，都会执行该job</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pipeline如下:</p><figure><img src="/assets/pipeline-BScAHsbe.png" alt="pipeline" tabindex="0" loading="lazy" width="1053" height="190"><figcaption>pipeline</figcaption></figure><h4 id="allow-failure" tabindex="-1"><a class="header-anchor" href="#allow-failure"><span>allow_failure</span></a></h4><p>跟<code>when</code>一起控制<code>job执行与否</code>的配置还有一个就是<code>allow_failure</code></p><p>allow_failure可以用于当你想设置一个job失败的之后并不影响后续的CI组件的时候。失败的jobs不会影响到commit状态。</p><p>下面的这个例子中，<code>java-package</code>和<code>java-package2</code>将会并列进行，如果<code>java-package2</code>失败了，它也不会影响进行中的下一个stage，因为这里有设置了allow_failure: true。</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">stages</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">before_script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pwd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">after_script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo after_script</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#单元测试</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">unit-test</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> verify</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo unit-test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#java编译</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">java-package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#java编译</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">java-package2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> execute_script_that_will_fail</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 该shell会导致job执行失败</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  allow_failure</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 不影响后面的任务进行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#push镜像</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">docker-push</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo docker-push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">service-1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo deploy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> manual</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cleanup_job</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cleanup</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo clean up</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  when</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> always</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>java-package2会执行错误</p><figure><img src="/assets/err_1-CTvc766C.png" alt="err" tabindex="0" loading="lazy" width="880" height="445"><figcaption>err</figcaption></figure><p>运行的pipeline如下，可见<code>java-package2</code>的执行错误</p><figure><img src="/assets/err_2-CFdoHbBt.png" alt="err" tabindex="0" loading="lazy" width="1048" height="229"><figcaption>err</figcaption></figure><h4 id="variables" tabindex="-1"><a class="header-anchor" href="#variables"><span>variables</span></a></h4><p>GitLab CI允许你为.gitlab-ci.yml增加变量，该变量将会被设置入任务环境。通过两种方式可以引用</p><p>美元符+大括号引用：<code>${}</code> 美元符：<code>$</code> 示例如下：</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">variables</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  SOFT_VERSION</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  TAG_NAME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">xxx</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#构建镜像</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">docker-build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  stage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerpush</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  tags</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> test-cicd</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  script</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker build -t $TAG_NAME:${SOFT_VERSION}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果有些值不想在配置文件中显示，比如密码什么的，可以在代码仓库中setting-&gt;CICD-&gt;Variables 自定义变量，跟在<code>.gitlab-ci.yml</code>配置变量效果是一样的</p><figure><img src="/assets/settings-B119MPcX.png" alt="settings" tabindex="0" loading="lazy" width="1295" height="588"><figcaption>settings</figcaption></figure><h4 id="variables的保留字" tabindex="-1"><a class="header-anchor" href="#variables的保留字"><span>variables的保留字</span></a></h4><p>gitlab-ci有一些预定义变量，这些变量大部分以<code>CI</code>开头</p><p>预定义变量：</p><table><thead><tr><th style="text-align:center;">Variable</th><th style="text-align:center;">GitLab</th><th style="text-align:center;">Runner</th><th style="text-align:center;">Description</th></tr></thead><tbody><tr><td style="text-align:center;">CI</td><td style="text-align:center;">all</td><td style="text-align:center;">0.4</td><td style="text-align:center;">标识该job是在CI环境中执行</td></tr><tr><td style="text-align:center;">CI_COMMIT_REF_NAME</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">用于构建项目的分支或tag名称</td></tr><tr><td style="text-align:center;">CI_COMMIT_REF_SLUG</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">先将$CI_COMMIT_REF_NAME的值转换成小写，最大不能超过63个字节，然后把除了0-9和a-z的其他字符转换成-。在URLs和域名名称中使用。</td></tr><tr><td style="text-align:center;">CI_COMMIT_SHA</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">commit的版本号</td></tr><tr><td style="text-align:center;">CI_COMMIT_TAG</td><td style="text-align:center;">9.0</td><td style="text-align:center;">0.5</td><td style="text-align:center;">commit的tag名称。只有创建了tags才会出现。</td></tr><tr><td style="text-align:center;">CI_DEBUG_TRACE</td><td style="text-align:center;">9.0</td><td style="text-align:center;">1.7</td><td style="text-align:center;">debug tracing开启时才生效</td></tr><tr><td style="text-align:center;">CI_ENVIRONMENT_NAME</td><td style="text-align:center;">8.15</td><td style="text-align:center;">all</td><td style="text-align:center;">job的环境名称</td></tr><tr><td style="text-align:center;">CI_ENVIRONMENT_SLUG</td><td style="text-align:center;">8.15</td><td style="text-align:center;">all</td><td style="text-align:center;">环境名称的简化版本，适用于DNS，URLs，Kubernetes labels等</td></tr><tr><td style="text-align:center;">CI_JOB_ID</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">GItLab CI内部调用job的一个唯一ID</td></tr><tr><td style="text-align:center;">CI_JOB_MANUAL</td><td style="text-align:center;">8.12</td><td style="text-align:center;">all</td><td style="text-align:center;">表示job启用的标识</td></tr><tr><td style="text-align:center;">CI_JOB_NAME</td><td style="text-align:center;">9.0</td><td style="text-align:center;">0.5</td><td style="text-align:center;">.gitlab-ci.yml中定义的job的名称</td></tr><tr><td style="text-align:center;">CI_JOB_STAGE</td><td style="text-align:center;">9.0</td><td style="text-align:center;">0.5</td><td style="text-align:center;">.gitlab-ci.yml中定义的stage的名称</td></tr><tr><td style="text-align:center;">CI_JOB_TOKEN</td><td style="text-align:center;">9.0</td><td style="text-align:center;">1.2</td><td style="text-align:center;">用于同GitLab容器仓库验证的token</td></tr><tr><td style="text-align:center;">CI_REPOSITORY_URL</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">git仓库地址，用于克隆</td></tr><tr><td style="text-align:center;">CI_RUNNER_DESCRIPTION</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">GitLab中存储的Runner描述</td></tr><tr><td style="text-align:center;">CI_RUNNER_ID</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">Runner所使用的唯一ID</td></tr><tr><td style="text-align:center;">CI_RUNNER_TAGS</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">Runner定义的tags</td></tr><tr><td style="text-align:center;">CI_PIPELINE_ID</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">GitLab CI 在内部使用的当前pipeline的唯一ID</td></tr><tr><td style="text-align:center;">CI_PIPELINE_TRIGGERED</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">用于指示该job被触发的标识</td></tr><tr><td style="text-align:center;">CI_PROJECT_DIR</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">仓库克隆的完整地址和job允许的完整地址</td></tr><tr><td style="text-align:center;">CI_PROJECT_ID</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">GitLab CI在内部使用的当前项目的唯一ID</td></tr><tr><td style="text-align:center;">CI_PROJECT_NAME</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">当前正在构建的项目名称（事实上是项目文件夹名称）</td></tr><tr><td style="text-align:center;">CI_PROJECT_NAMESPACE</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">当前正在构建的项目命名空间（用户名或者是组名称）</td></tr><tr><td style="text-align:center;">CI_PROJECT_PATH</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">命名空间加项目名称</td></tr><tr><td style="text-align:center;">CI_PROJECT_PATH_SLUG</td><td style="text-align:center;">9.3</td><td style="text-align:center;">all</td><td style="text-align:center;">$CI_PROJECT_PATH小写字母、除了0-9和a-z的其他字母都替换成-。用于地址和域名名称。</td></tr><tr><td style="text-align:center;">CI_PROJECT_URL</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">项目的访问地址（http形式）</td></tr><tr><td style="text-align:center;">CI_REGISTRY</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">如果启用了Container Registry，则返回GitLab的Container Registry的地址</td></tr><tr><td style="text-align:center;">CI_REGISTRY_IMAGE</td><td style="text-align:center;">8.10</td><td style="text-align:center;">0.5</td><td style="text-align:center;">如果为项目启用了Container Registry，它将返回与特定项目相关联的注册表的地址</td></tr><tr><td style="text-align:center;">CI_REGISTRY_PASSWORD</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">用于push containers到GitLab的Container Registry的密码</td></tr><tr><td style="text-align:center;">CI_REGISTRY_USER</td><td style="text-align:center;">9.0</td><td style="text-align:center;">all</td><td style="text-align:center;">用于push containers到GItLab的Container Registry的用户名</td></tr><tr><td style="text-align:center;">CI_SERVER</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">标记该job是在CI环境中执行</td></tr><tr><td style="text-align:center;">CI_SERVER_NAME</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">用于协调job的CI服务器名称</td></tr><tr><td style="text-align:center;">CI_SERVER_REVISION</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">用于调度job的GitLab修订版</td></tr><tr><td style="text-align:center;">CI_SERVER_VERSION</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">用于调度job的GItLab版本</td></tr><tr><td style="text-align:center;">ARTIFACT_DOWNLOAD_ATTEMPTS</td><td style="text-align:center;">8.15</td><td style="text-align:center;">1.9</td><td style="text-align:center;">尝试运行下载artifacts的job的次数</td></tr><tr><td style="text-align:center;">GET_SOURCES_ATTEMPTS</td><td style="text-align:center;">8.15</td><td style="text-align:center;">1.9</td><td style="text-align:center;">尝试运行获取源的job次数</td></tr><tr><td style="text-align:center;">GITLAB_CI</td><td style="text-align:center;">all</td><td style="text-align:center;">all</td><td style="text-align:center;">用于指示该job是在GItLab CI环境中运行</td></tr><tr><td style="text-align:center;">GITLAB_USER_ID</td><td style="text-align:center;">8.12</td><td style="text-align:center;">all</td><td style="text-align:center;">开启该job的用户ID</td></tr><tr><td style="text-align:center;">GITLAB_USER_EMAIL</td><td style="text-align:center;">8.12</td><td style="text-align:center;">all</td><td style="text-align:center;">开启该job的用户邮箱</td></tr><tr><td style="text-align:center;">RESTORE_CACHE_ATTEMPTS</td><td style="text-align:center;">8.15</td><td style="text-align:center;">1.9</td><td style="text-align:center;">尝试运行存储缓存的job的次数</td></tr></tbody></table><p>更多配置，可以参考官方参考文档：https://docs.gitlab.com/ee/ci/yaml/</p></div><!--[--><h2 id="doc-contributors" tabindex="-1"><a href="#doc-contributors" class="header-anchor"><span>贡献者</span></a></h2><div class="vp-contributors"><a href="https://github.com/sreio" target="_blank" rel="noreferrer" class="vp-contributor"><img src="https://avatars.githubusercontent.com/sreio?v=4" alt class="vp-contributor-avatar"><span class="vp-contributor-name">sreio</span></a></div><!--]--><!--[--><h2 id="doc-changelog" tabindex="-1"><a href="#doc-changelog" class="header-anchor"><span>更新日志</span></a></h2><div class="vp-changelog-wrapper"><div class="vp-changelog-header"><div class="vp-latest-updated"><span class="vp-changelog-icon"></span><span data-allow-mismatch>2025/12/29 16:03</span></div><div><span class="vp-changelog-menu-icon"></span><span>查看所有更新日志</span></div></div><ul class="vp-changelog-list"><!--[--><li class="vp-changelog-item-commit"><a class="vp-changelog-hash" href="https://github.com/sreio/sreio-docs/commit/6dd596b6752ea1c49be57e00b1b0c941c0324a5d" target="_blank" rel="noreferrer"><code>6dd59</code></a><span class="vp-changelog-divider">-</span><span class="vp-changelog-message">feat: Add new documentation across Go, PHP, Docker, Linux, Database, Middleware, and Fundamentals, while removing some old images and files.</span><span class="vp-changelog-date" data-allow-mismatch>于 <time datetime="2025-12-29T16:03:14.000Z">2025/12/29</time></span></li><li class="vp-changelog-item-commit"><a class="vp-changelog-hash" href="https://github.com/sreio/sreio-docs/commit/309568ac808a0e32f2a30faf8785a5bb75211f52" target="_blank" rel="noreferrer"><code>30956</code></a><span class="vp-changelog-divider">-</span><span class="vp-changelog-message">docker</span><span class="vp-changelog-date" data-allow-mismatch>于 <time datetime="2025-07-07T08:09:54.000Z">2025/7/7</time></span></li><li class="vp-changelog-item-commit"><a class="vp-changelog-hash" href="https://github.com/sreio/sreio-docs/commit/53d182dfadaf1adec371a2cdf1b84b4b76472596" target="_blank" rel="noreferrer"><code>53d18</code></a><span class="vp-changelog-divider">-</span><span class="vp-changelog-message">gitlab</span><span class="vp-changelog-date" data-allow-mismatch>于 <time datetime="2025-07-07T06:54:27.000Z">2025/7/7</time></span></li><!--]--></ul></div><!--]--><!----></div></main><footer class="vp-doc-footer" data-v-23f6ad98 data-v-fda6bbae><!--[--><!--]--><div class="edit-info" data-v-fda6bbae><div class="edit-link" data-v-fda6bbae><a class="vp-link link no-icon edit-link-button" href="https://github.com/sreio/sreio-docs/edit/main/docs/devops/gitlab/1.git_ci_cd.md" target="_blank" rel="noreferrer" data-v-fda6bbae><!--[--><span class="vpi-square-pen edit-link-icon" aria-label="edit icon" data-v-fda6bbae></span> 编辑此页<!--]--><!----></a></div><!----></div><!----><!----></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-d90a7a26 data-v-bcf8d9a6><span class="percent" data-allow-mismatch data-v-bcf8d9a6>0%</span><span class="show icon vpi-back-to-top" data-v-bcf8d9a6></span><svg aria-hidden="true" data-v-bcf8d9a6><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-bcf8d9a6></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-d90a7a26 data-v-400675cf><!--[--><div class="container" data-v-400675cf><p class="message" data-v-400675cf>Sreio Docs </p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-DWByWgeb.js" defer></script></body></html>